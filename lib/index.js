var pathExists = require("path-exists");
var fs = require("fs");
var merge = require("json-add");
var Promise = require("bluebird");
var exec = require('promised-exec');
var outputFileSync = fs.writeFileSync;
module.exports = function (options) {
    return new Promise(function (resolve, reject) {
        if (!pathExists.sync('/etc/default/hostapd')) {
            reject('no default conf file was founded for hostapd');
        }
        if (!options || typeof (options) != 'object') {
            reject('Type Error, provide a valid json object');
        }
        if (!options.interface) {
            reject('No configuration interface was provided');
        }
        if (!options.ssid) {
            reject('No configuration interface was provided');
        }
        function parsemasq(config) {
            var write = '';
            for (var c = 0; c < Object.keys(config).length; c++) {
                if (Object.keys(config)[c] != 'path') {
                    write = write + Object.keys(config)[c] + '=' + config[Object.keys(config)[c]] + '\n';
                }
            }
            return write;
        }
        var config = {
            path: '/etc/hostapd/hostapd.conf',
            driver: 'nl80211',
            hw_mode: 'g',
            channel: 2,
            macaddr_acl: 0,
            auth_algs: 1,
            ignore_broadcast_ssid: 0,
            test: false
        };
        if (options.wpa_passphrase) {
            var wpa_standard = {
                wpa: 2,
                wpa_key_mgmt: 'WPA-PSK',
                wpa_pairwise: 'TKIP',
                rsn_pairwise: 'CCMP'
            };
            merge(config, wpa_standard);
        }
        merge(config, options);
        if (!config.test) {
            outputFileSync('/etc/default/hostapd', 'DAEMON_CONF="' + config.path + '"', 'utf-8');
        }
        outputFileSync(config.path, parsemasq(config), 'utf-8');
        if (!config.test) {
            exec('systemctl restart hostapd').then(function () {
                resolve(config);
            }).catch(function (err) {
                console.log(err);
                reject(err);
            });
        }
        else {
            exec('echo').then(function () {
                resolve(config);
            }).catch(function (err) {
                console.log(err);
                reject(err);
            });
        }
    });
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9pbmRleC50cyJdLCJuYW1lcyI6WyJwYXJzZW1hc3EiXSwibWFwcGluZ3MiOiJBQUFBLElBQVksVUFBVSxXQUFNLGFBQWEsQ0FBQyxDQUFBO0FBQzFDLElBQVksRUFBRSxXQUFNLElBQUksQ0FBQyxDQUFBO0FBQ3pCLElBQU8sS0FBSyxXQUFVLFVBQVUsQ0FBQyxDQUFDO0FBQ2xDLElBQVksT0FBTyxXQUFNLFVBQVUsQ0FBQyxDQUFBO0FBQ3BDLElBQU8sSUFBSSxXQUFTLGVBQWUsQ0FBQyxDQUFDO0FBQ3JDLElBQUksY0FBYyxHQUFHLEVBQUUsQ0FBQyxhQUFhLENBQUM7QUFHdEMsaUJBQU8sVUFBUyxPQUE0RDtJQUMxRSxNQUFNLENBQUMsSUFBSSxPQUFPLENBQUMsVUFBUyxPQUFPLEVBQUMsTUFBTTtRQUUxQyxFQUFFLENBQUEsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFBLENBQUM7WUFDM0MsTUFBTSxDQUFDLDhDQUE4QyxDQUFDLENBQUE7UUFDeEQsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxJQUFJLE9BQU0sQ0FBQyxPQUFPLENBQUMsSUFBRSxRQUFRLENBQUMsQ0FBQSxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFBO1FBQ25ELENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQSxDQUFDO1lBQ3JCLE1BQU0sQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFBO1FBQ25ELENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFDO1lBQ2hCLE1BQU0sQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFBO1FBQ25ELENBQUM7UUFFRCxtQkFBbUIsTUFBTTtZQUN2QkEsSUFBSUEsS0FBS0EsR0FBQ0EsRUFBRUEsQ0FBQ0E7WUFDYkEsR0FBR0EsQ0FBQUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsRUFBQ0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBQ0EsQ0FBQ0EsRUFBRUEsRUFBQ0EsQ0FBQ0E7Z0JBQzVDQSxFQUFFQSxDQUFBQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFFQSxNQUFNQSxDQUFDQSxDQUFBQSxDQUFDQTtvQkFDakNBLEtBQUtBLEdBQUNBLEtBQUtBLEdBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLEdBQUdBLEdBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBO2dCQUM3RUEsQ0FBQ0E7WUFDSEEsQ0FBQ0E7WUFDREEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQUE7UUFDZEEsQ0FBQ0E7UUFFRCxJQUFJLE1BQU0sR0FBQztZQUNULElBQUksRUFBQywyQkFBMkI7WUFDaEMsTUFBTSxFQUFDLFNBQVM7WUFDaEIsT0FBTyxFQUFDLEdBQUc7WUFDWCxPQUFPLEVBQUMsQ0FBQztZQUNULFdBQVcsRUFBQyxDQUFDO1lBQ2IsU0FBUyxFQUFDLENBQUM7WUFDWCxxQkFBcUIsRUFBQyxDQUFDO1lBQ3ZCLElBQUksRUFBQyxLQUFLO1NBQ1gsQ0FBQTtRQUlELEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQSxDQUFDO1lBQ3pCLElBQUksWUFBWSxHQUFDO2dCQUNmLEdBQUcsRUFBQyxDQUFDO2dCQUNMLFlBQVksRUFBQyxTQUFTO2dCQUN0QixZQUFZLEVBQUMsTUFBTTtnQkFDbkIsWUFBWSxFQUFDLE1BQU07YUFDcEIsQ0FBQTtZQUNELEtBQUssQ0FBQyxNQUFNLEVBQUMsWUFBWSxDQUFDLENBQUE7UUFDNUIsQ0FBQztRQUVELEtBQUssQ0FBQyxNQUFNLEVBQUMsT0FBTyxDQUFDLENBQUE7UUFDckIsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUEsQ0FBQztZQUVsQixjQUFjLENBQUMsc0JBQXNCLEVBQUUsZUFBZSxHQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRWpGLENBQUM7UUFHRCxjQUFjLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDeEQsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUEsQ0FBQztZQUVoQixJQUFJLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ3JDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUNqQixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBUyxHQUFHO2dCQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUNoQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDYixDQUFDLENBQUMsQ0FBQTtRQUNOLENBQUM7UUFBQSxJQUFJLENBQUEsQ0FBQztZQUNKLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ2hCLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUNqQixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBUyxHQUFHO2dCQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUNoQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDYixDQUFDLENBQUMsQ0FBQTtRQUNKLENBQUM7SUFDQyxDQUFDLENBQUMsQ0FBQTtBQUVKLENBQUMsQ0FBQyIsImZpbGUiOiJsaWIvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoRXhpc3RzIGZyb20gXCJwYXRoLWV4aXN0c1wiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgbWVyZ2UgPXJlcXVpcmUoXCJqc29uLWFkZFwiKTtcbmltcG9ydCAqIGFzIFByb21pc2UgZnJvbSBcImJsdWViaXJkXCI7XG5pbXBvcnQgZXhlYz1yZXF1aXJlKCdwcm9taXNlZC1leGVjJyk7XG52YXIgb3V0cHV0RmlsZVN5bmMgPSBmcy53cml0ZUZpbGVTeW5jO1xuXG5cbmV4cG9ydD1mdW5jdGlvbihvcHRpb25zOntpbnRlcmZhY2U6c3RyaW5nLHNzaWQ6c3RyaW5nLHdwYV9wYXNzcGhyYXNlOnN0cmluZ30pe1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSxyZWplY3Qpe1xuXG4gIGlmKCFwYXRoRXhpc3RzLnN5bmMoJy9ldGMvZGVmYXVsdC9ob3N0YXBkJykpe1xuICAgIHJlamVjdCgnbm8gZGVmYXVsdCBjb25mIGZpbGUgd2FzIGZvdW5kZWQgZm9yIGhvc3RhcGQnKVxuICB9XG4gIGlmKCFvcHRpb25zIHx8IHR5cGVvZihvcHRpb25zKSE9J29iamVjdCcpe1xuICAgIHJlamVjdCgnVHlwZSBFcnJvciwgcHJvdmlkZSBhIHZhbGlkIGpzb24gb2JqZWN0JylcbiAgfVxuICBpZighb3B0aW9ucy5pbnRlcmZhY2Upe1xuICAgIHJlamVjdCgnTm8gY29uZmlndXJhdGlvbiBpbnRlcmZhY2Ugd2FzIHByb3ZpZGVkJylcbiAgfVxuICBpZighb3B0aW9ucy5zc2lkKXtcbiAgICByZWplY3QoJ05vIGNvbmZpZ3VyYXRpb24gaW50ZXJmYWNlIHdhcyBwcm92aWRlZCcpXG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZW1hc3EoY29uZmlnKXtcbiAgICB2YXIgd3JpdGU9Jyc7XG4gICAgZm9yKHZhciBjPTA7YzxPYmplY3Qua2V5cyhjb25maWcpLmxlbmd0aDtjKyspe1xuICAgICAgaWYoT2JqZWN0LmtleXMoY29uZmlnKVtjXSE9J3BhdGgnKXtcbiAgICAgICAgd3JpdGU9d3JpdGUrT2JqZWN0LmtleXMoY29uZmlnKVtjXSsnPScrY29uZmlnW09iamVjdC5rZXlzKGNvbmZpZylbY11dKydcXG4nO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gd3JpdGVcbiAgfVxuXG4gIHZhciBjb25maWc9e1xuICAgIHBhdGg6Jy9ldGMvaG9zdGFwZC9ob3N0YXBkLmNvbmYnLFxuICAgIGRyaXZlcjonbmw4MDIxMScsXG4gICAgaHdfbW9kZTonZycsXG4gICAgY2hhbm5lbDoyLFxuICAgIG1hY2FkZHJfYWNsOjAsXG4gICAgYXV0aF9hbGdzOjEsXG4gICAgaWdub3JlX2Jyb2FkY2FzdF9zc2lkOjAsXG4gICAgdGVzdDpmYWxzZVxuICB9XG5cblxuXG4gIGlmKG9wdGlvbnMud3BhX3Bhc3NwaHJhc2Upe1xuICAgIHZhciB3cGFfc3RhbmRhcmQ9e1xuICAgICAgd3BhOjIsXG4gICAgICB3cGFfa2V5X21nbXQ6J1dQQS1QU0snLFxuICAgICAgd3BhX3BhaXJ3aXNlOidUS0lQJyxcbiAgICAgIHJzbl9wYWlyd2lzZTonQ0NNUCdcbiAgICB9XG4gICAgbWVyZ2UoY29uZmlnLHdwYV9zdGFuZGFyZClcbiAgfVxuXG4gIG1lcmdlKGNvbmZpZyxvcHRpb25zKVxuICBpZiAoIWNvbmZpZy50ZXN0KXtcbiAgLy8gaWYoZnMucmVhZEZpbGVTeW5jKCcvZXRjL2RlZmF1bHQvaG9zdGFwZCcpIT0nREFFTU9OX0NPTkY9XCInK2NvbmZpZy5wYXRoKydcIicpe1xuICBvdXRwdXRGaWxlU3luYygnL2V0Yy9kZWZhdWx0L2hvc3RhcGQnLCAnREFFTU9OX0NPTkY9XCInK2NvbmZpZy5wYXRoKydcIicsICd1dGYtOCcpO1xuICAvLyB9XG4gIH1cblxuICAvLyBtYW5jYSBpbCBjb250cm9sbG8gY2hlIGV2aXRhIGRpIHJpc2NyaXZlcmUgaWwgZmlsZSBzZSDDqCBpZGVudGljbyBhIHF1ZWxsbyBwcmVzZW50ZVxuICBvdXRwdXRGaWxlU3luYyhjb25maWcucGF0aCwgcGFyc2VtYXNxKGNvbmZpZyksICd1dGYtOCcpO1xuICBpZiAoIWNvbmZpZy50ZXN0KXtcblxuICAgIGV4ZWMoJ3N5c3RlbWN0bCByZXN0YXJ0IGhvc3RhcGQnKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICByZXNvbHZlKGNvbmZpZylcbiAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgcmVqZWN0KGVycilcbiAgICB9KVxufWVsc2V7XG4gIGV4ZWMoJ2VjaG8nKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgcmVzb2x2ZShjb25maWcpXG4gIH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG4gICAgY29uc29sZS5sb2coZXJyKVxuICAgIHJlamVjdChlcnIpXG4gIH0pXG59XG4gIH0pXG5cbn07XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
