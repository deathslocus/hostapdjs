var pathExists = require("path-exists");
var fs = require("fs");
var merge = require("json-add");
var Promise = require("bluebird");
var exec = require("promised-exec");
function Hostapdjs(options) {
    var outputFileSync = fs.writeFileSync;
    return new Promise(function (resolve, reject) {
        if (!pathExists.sync('/etc/default/hostapd')) {
            reject('no default conf file was founded for hostapd');
        }
        if (!options || typeof (options) != 'object') {
            reject('Type Error, provide a valid json object');
        }
        if (!options.interface) {
            reject('No configuration interface was provided');
        }
        if (!options.ssid) {
            reject('No configuration interface was provided');
        }
        function parsemasq(config) {
            var write = '';
            for (var c = 0; c < Object.keys(config).length; c++) {
                if (Object.keys(config)[c] != 'path' && Object.keys(config)[c] != 'test') {
                    write = write + Object.keys(config)[c] + '=' + config[Object.keys(config)[c]] + '\n';
                }
            }
            return write;
        }
        var config = {
            path: '/etc/hostapd/hostapd.conf',
            driver: 'nl80211',
            hw_mode: 'g',
            channel: 2,
            macaddr_acl: 0,
            auth_algs: 1,
            ignore_broadcast_ssid: 0,
            test: false
        };
        if (options.wpa_passphrase) {
            var wpa_standard = {
                wpa: 2,
                wpa_key_mgmt: 'WPA-PSK',
                wpa_pairwise: 'TKIP',
                rsn_pairwise: 'CCMP'
            };
            merge(config, wpa_standard);
        }
        merge(config, options);
        if (!config.test) {
            outputFileSync('/etc/default/hostapd', 'DAEMON_CONF="' + config.path + '"', 'utf-8');
        }
        outputFileSync(config.path, parsemasq(config), 'utf-8');
        if (!config.test) {
            exec('systemctl restart hostapd').then(function () {
                resolve(config);
            }).catch(function (err) {
                console.log(err);
                reject(err);
            });
        }
        else {
            exec('echo').then(function () {
                resolve(config);
            }).catch(function (err) {
                console.log(err);
                reject(err);
            });
        }
    });
}
;
module.exports = Hostapdjs;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9pbmRleC50cyJdLCJuYW1lcyI6WyJIb3N0YXBkanMiLCJwYXJzZW1hc3EiXSwibWFwcGluZ3MiOiJBQUFBLElBQVksVUFBVSxXQUFNLGFBQWEsQ0FBQyxDQUFBO0FBQzFDLElBQVksRUFBRSxXQUFNLElBQUksQ0FBQyxDQUFBO0FBQ3pCLElBQU8sS0FBSyxXQUFVLFVBQVUsQ0FBQyxDQUFDO0FBQ2xDLElBQVksT0FBTyxXQUFNLFVBQVUsQ0FBQyxDQUFBO0FBQ3BDLElBQUksSUFBSSxHQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQWVsQyxtQkFBbUIsT0FBNEQ7SUFDdkVBLElBQUlBLGNBQWNBLEdBQUdBLEVBQUVBLENBQUNBLGFBQWFBLENBQUNBO0lBQzVDQSxNQUFNQSxDQUFDQSxJQUFJQSxPQUFPQSxDQUFVQSxVQUFTQSxPQUFPQSxFQUFDQSxNQUFNQTtRQUVuRCxFQUFFLENBQUEsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFBLENBQUM7WUFDM0MsTUFBTSxDQUFDLDhDQUE4QyxDQUFDLENBQUE7UUFDeEQsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxJQUFJLE9BQU0sQ0FBQyxPQUFPLENBQUMsSUFBRSxRQUFRLENBQUMsQ0FBQSxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFBO1FBQ25ELENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQSxDQUFDO1lBQ3JCLE1BQU0sQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFBO1FBQ25ELENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFDO1lBQ2hCLE1BQU0sQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFBO1FBQ25ELENBQUM7UUFFRCxtQkFBbUIsTUFBTTtZQUN2QkMsSUFBSUEsS0FBS0EsR0FBQ0EsRUFBRUEsQ0FBQ0E7WUFD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RCxDQUFBQTtBQUVKQSxDQUFDQTtBQUFBLENBQUM7QUFDRixpQkFBTyxTQUFTLENBQUMiLCJmaWxlIjoibGliL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGF0aEV4aXN0cyBmcm9tIFwicGF0aC1leGlzdHNcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IG1lcmdlID1yZXF1aXJlKFwianNvbi1hZGRcIik7XG5pbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gXCJibHVlYmlyZFwiO1xubGV0IGV4ZWM9cmVxdWlyZShcInByb21pc2VkLWV4ZWNcIik7XG5cblxuaW50ZXJmYWNlIEljb25maWcge1xuICAgICAgICBwYXRoOnN0cmluZztcbiAgICBkcml2ZXI6c3RyaW5nO1xuICAgIGh3X21vZGU6c3RyaW5nO1xuICAgIGNoYW5uZWw6bnVtYmVyO1xuICAgIG1hY2FkZHJfYWNsOm51bWJlcjtcbiAgICBhdXRoX2FsZ3M6bnVtYmVyO1xuICAgIGlnbm9yZV9icm9hZGNhc3Rfc3NpZDpudW1iZXI7XG4gICAgdGVzdDpib29sZWFuO1xufVxuXG5cbmZ1bmN0aW9uIEhvc3RhcGRqcyhvcHRpb25zOntpbnRlcmZhY2U6c3RyaW5nLHNzaWQ6c3RyaW5nLHdwYV9wYXNzcGhyYXNlOnN0cmluZ30pe1xuICAgICAgICBsZXQgb3V0cHV0RmlsZVN5bmMgPSBmcy53cml0ZUZpbGVTeW5jO1xuICByZXR1cm4gbmV3IFByb21pc2U8SWNvbmZpZz4oZnVuY3Rpb24ocmVzb2x2ZSxyZWplY3Qpe1xuXG4gIGlmKCFwYXRoRXhpc3RzLnN5bmMoJy9ldGMvZGVmYXVsdC9ob3N0YXBkJykpe1xuICAgIHJlamVjdCgnbm8gZGVmYXVsdCBjb25mIGZpbGUgd2FzIGZvdW5kZWQgZm9yIGhvc3RhcGQnKVxuICB9XG4gIGlmKCFvcHRpb25zIHx8IHR5cGVvZihvcHRpb25zKSE9J29iamVjdCcpe1xuICAgIHJlamVjdCgnVHlwZSBFcnJvciwgcHJvdmlkZSBhIHZhbGlkIGpzb24gb2JqZWN0JylcbiAgfVxuICBpZighb3B0aW9ucy5pbnRlcmZhY2Upe1xuICAgIHJlamVjdCgnTm8gY29uZmlndXJhdGlvbiBpbnRlcmZhY2Ugd2FzIHByb3ZpZGVkJylcbiAgfVxuICBpZighb3B0aW9ucy5zc2lkKXtcbiAgICByZWplY3QoJ05vIGNvbmZpZ3VyYXRpb24gaW50ZXJmYWNlIHdhcyBwcm92aWRlZCcpXG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZW1hc3EoY29uZmlnKXtcbiAgICB2YXIgd3JpdGU9Jyc7XG4gICAgZm9yKHZhciBjPTA7YzxPYmplY3Qua2V5cyhjb25maWcpLmxlbmd0aDtjKyspe1xuICAgICAgaWYoT2JqZWN0LmtleXMoY29uZmlnKVtjXSE9J3BhdGgnJiZPYmplY3Qua2V5cyhjb25maWcpW2NdIT0ndGVzdCcpe1xuICAgICAgICB3cml0ZT13cml0ZStPYmplY3Qua2V5cyhjb25maWcpW2NdKyc9Jytjb25maWdbT2JqZWN0LmtleXMoY29uZmlnKVtjXV0rJ1xcbic7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB3cml0ZVxuICB9XG5cblxuXG4gIGxldCBjb25maWc9PEljb25maWc+e1xuICAgIHBhdGg6Jy9ldGMvaG9zdGFwZC9ob3N0YXBkLmNvbmYnLFxuICAgIGRyaXZlcjonbmw4MDIxMScsXG4gICAgaHdfbW9kZTonZycsXG4gICAgY2hhbm5lbDoyLFxuICAgIG1hY2FkZHJfYWNsOjAsXG4gICAgYXV0aF9hbGdzOjEsXG4gICAgaWdub3JlX2Jyb2FkY2FzdF9zc2lkOjAsXG4gICAgdGVzdDpmYWxzZVxuICB9XG5cblxuXG4gIGlmKG9wdGlvbnMud3BhX3Bhc3NwaHJhc2Upe1xuICAgIHZhciB3cGFfc3RhbmRhcmQ9e1xuICAgICAgd3BhOjIsXG4gICAgICB3cGFfa2V5X21nbXQ6J1dQQS1QU0snLFxuICAgICAgd3BhX3BhaXJ3aXNlOidUS0lQJyxcbiAgICAgIHJzbl9wYWlyd2lzZTonQ0NNUCdcbiAgICB9XG4gICAgbWVyZ2UoY29uZmlnLHdwYV9zdGFuZGFyZClcbiAgfVxuXG4gIG1lcmdlKGNvbmZpZyxvcHRpb25zKVxuICBpZiAoIWNvbmZpZy50ZXN0KXtcbiAgLy8gaWYoZnMucmVhZEZpbGVTeW5jKCcvZXRjL2RlZmF1bHQvaG9zdGFwZCcpIT0nREFFTU9OX0NPTkY9XCInK2NvbmZpZy5wYXRoKydcIicpe1xuICBvdXRwdXRGaWxlU3luYygnL2V0Yy9kZWZhdWx0L2hvc3RhcGQnLCAnREFFTU9OX0NPTkY9XCInK2NvbmZpZy5wYXRoKydcIicsICd1dGYtOCcpO1xuICAvLyB9XG4gIH1cblxuICAvLyBtYW5jYSBpbCBjb250cm9sbG8gY2hlIGV2aXRhIGRpIHJpc2NyaXZlcmUgaWwgZmlsZSBzZSDDqCBpZGVudGljbyBhIHF1ZWxsbyBwcmVzZW50ZVxuICBvdXRwdXRGaWxlU3luYyhjb25maWcucGF0aCwgcGFyc2VtYXNxKGNvbmZpZyksICd1dGYtOCcpO1xuICBpZiAoIWNvbmZpZy50ZXN0KXtcblxuICAgIGV4ZWMoJ3N5c3RlbWN0bCByZXN0YXJ0IGhvc3RhcGQnKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICByZXNvbHZlKGNvbmZpZylcbiAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgcmVqZWN0KGVycilcbiAgICB9KVxufWVsc2V7XG4gIGV4ZWMoJ2VjaG8nKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgcmVzb2x2ZShjb25maWcpXG4gIH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG4gICAgY29uc29sZS5sb2coZXJyKVxuICAgIHJlamVjdChlcnIpXG4gIH0pXG59XG4gIH0pXG5cbn07XG5leHBvcnQ9SG9zdGFwZGpzOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
